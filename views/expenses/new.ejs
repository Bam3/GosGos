<% layout('layouts/boilerplate')%>
<div class="row">
    <h1>Dodaj strošek</h1>
    <div class="col-md-6">
        <form
            action="/expenses"
            class="validated-form"
            method="POST"
            id="addNewExpense"
            novalidate
        >
            <div class="mb-3">
                <label for="category" class="form-label">Kategorija</label>
                <select
                    class="form-select"
                    id="category"
                    name="category"
                    required
                >
                    <option selected disabled value="">Izberi...</option>
                    <% for(let category of context.categories){ %>
                    <optgroup label="<%=category.name%>">
                        <% for(let subCategory of category.subCategories){ %>
                        <option id="Option" value="<%=subCategory._id%>">
                            <%=subCategory.name%>
                        </option>
                        <% } %>
                    </optgroup>
                    <% } %>
                </select>
                <div class="invalid-feedback">Kategorija je obvezna.</div>
            </div>

            <div class="mb-3">
                <label for="price" class="form-label">Strošek</label>
                <div class="input-group">
                    <input
                        id="price"
                        name="price"
                        type="number"
                        class="form-control"
                        step=".01"
                        aria-label="Amount"
                        required
                    />
                    <span class="input-group-text">€</span>
                    <div class="invalid-feedback">Cena je obvezna.</div>
                </div>
            </div>

            <div class="mb-3">
                <label for="description" class="form-label">Komentar</label>
                <div class="input-group">
                    <textarea
                        id="description"
                        name="description"
                        type="text"
                        class="form-control"
                    ></textarea>
                </div>
            </div>

            <div class="mb-3">
                <label for="date" class="form-label">Dan plačila</label>
                <div class="input-group">
                    <input
                        id="date"
                        name="payDate"
                        type="date"
                        value="<%=new Date().toJSON().slice(0, 10)%>"
                        class="form-control"
                        autocomplete
                        required
                    />
                    <div class="invalid-feedback">Dan plačila je obvezen.</div>
                </div>
            </div>

            <div class="mb-3">
                <label for="user" class="form-label">Plačnik</label>
                <select class="form-select" id="user" name="user" required>
                    <option selected disabled value>Izberi plačnika...</option>
                    <% for(let user of context.users) { %>
                    <option value="<%=user._id%>"><%=user.username%></option>
                    <% } %>
                </select>
                <div class="invalid-feedback">Plačnik je obvezen!</div>
            </div>

            <div class="mb-3">
                <div class="form-check form-switch">
                    <input
                        class="form-check-input"
                        type="checkbox"
                        role="switch"
                        id="flexSwitchCheckChecked"
                        name="shared"
                        value="true"
                        checked
                    />
                    <label class="form-check-label" for="flexSwitchCheckChecked"
                        >Deljen strošek</label
                    >
                </div>
            </div>
            <div class="row mb-4">
                <div class="d-grid col-12 mx-auto">
                    <button class="btn btn-secondary">Dodaj</button>
                </div>
            </div>
        </form>
        <div class="col-md-12 table-responsive">
            <table class="table table-hover table-borderless">
                <thead class="table-light">
                    <tr>
                        <th colspan="4" class="text-center">
                            ZADNJI VNEŠENI - SKUPNI
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <% for (let i = 0; i < expenses.sharedExpenses.length; i++)
                    { %>
                    <tr>
                        <td class="align-middle" scope="row">
                            <div>
                                <%=expenses.sharedExpenses[i].payDate.toLocaleDateString('de-CH',{year:"2-digit",
                                month: "2-digit", day:"2-digit"})%>
                            </div>
                        </td>
                        <td class="align-middle">
                            <div>
                                <%=expenses.sharedExpenses[i].category.name %>
                            </div>
                        </td>
                        <td class="align-middle">
                            <div>
                                <a
                                    href="/expenses/<%= expenses.sharedExpenses[i].id %>"
                                    >€<%=expenses.sharedExpenses[i].cost.toFixed(2)
                                    %></a
                                >
                            </div>
                        </td>
                        <td class="p-1 d-flex justify-content-center">
                            <div
                                class="name-tag"
                                style="
                                    background-color: <%=expenses.sharedExpenses[i].payer.color
                                        %>;
                                "
                            >
                                <%=expenses.sharedExpenses[i].payer.nickName %>
                            </div>
                        </td>
                    </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
        <%if (expenses.usersExpenses.length > 0) {%>
        <div class="col-md-12 table-responsive">
            <table class="table table-hover table-borderless">
                <thead class="table-light">
                    <tr>
                        <th colspan="4" class="text-center">
                            ZADNJI VNEŠENI - MOJI
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <% for (let i = 0; i < expenses.usersExpenses.length; i++) {
                    %>
                    <tr>
                        <td class="align-middle" scope="row">
                            <div>
                                <%=expenses.usersExpenses[i].payDate.toLocaleDateString('de-CH',{year:"2-digit",
                                month: "2-digit", day:"2-digit"})%>
                            </div>
                        </td>
                        <td class="align-middle">
                            <div>
                                <%=expenses.usersExpenses[i].category.name %>
                            </div>
                        </td>
                        <td class="align-middle">
                            <div>
                                <a
                                    href="/expenses/<%= expenses.usersExpenses[i].id %>"
                                    >€<%=expenses.usersExpenses[i].cost.toFixed(2)
                                    %></a
                                >
                            </div>
                        </td>
                        <td class="p-1 d-flex justify-content-center">
                            <div
                                class="name-tag"
                                style="
                                    background-color: <%=expenses.usersExpenses[i].payer.color
                                        %>;
                                "
                            >
                                <%=expenses.usersExpenses[i].payer.nickName %>
                            </div>
                        </td>
                    </tr>
                    <% } %>
                </tbody>
            </table>
        </div>
        <%}%>
        <!-- <form
            action="/camera/photo"
            method="POST"
            id="addNewPhoto"
            enctype="multipart/form-data"
        >
            <div class="d-grid col-12 mx-auto my-2">
                <a
                    id="startbutton"
                    href="/camera/photo"
                    class="btn btn btn-outline-secondary"
                >
                    <input
                        id="take-picture"
                        type="file"
                        name="picture"
                        accept="image/*"
                        capture="user"
                        hidden
                        onchange="form.submit()"
                    />
                    <label for="take-picture">
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="24"
                            height="24"
                            fill="currentColor"
                            class="bi bi-camera"
                            viewBox="0 0 16 16"
                        >
                            <path
                                d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1v6zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4H2z"
                            />
                            <path
                                d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5zm0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7zM3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0z"
                            />
                        </svg>
                    </label>
                </a>
            </div>
        </form> -->
    </div>
</div>
<div class="position-fixed bottom-50 end-25 p-3" style="z-index: 11">
    <div
        id="liveToast"
        class="toast"
        role="alert"
        aria-live="assertive"
        aria-atomic="true"
    >
        <div id="progress-title" class="toast-header"></div>
        <div class="toast-body">
            <div class="progress">
                <div
                    id="progress"
                    class="progress-bar progress-bar-striped progress-bar-animated bg-warning"
                    role="progressbar"
                    aria-valuenow="75"
                    aria-valuemin="0"
                    aria-valuemax="100"
                    style="width: 0%"
                ></div>
            </div>
        </div>
    </div>
</div>

<script>
    const categories = <%- JSON.stringify(context.categories) %>
</script>
<script src="/javascripts/readPhoto.js"></script>

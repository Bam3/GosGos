<% layout('layouts/boilerplate')%>
<div class="row">
    <div class="col-md-12">
        <h1>Stroški</h1>
    </div>

    <div class="col-md-3 mb-4">
        <form action="/expenses/filter" method="POST" id="addNewExpense">
            <label for="dateFrom">Dan Plačila - od:</label>
            <div class="input-group mb-3">
                <input
                    id="dateFrom"
                    name="dateFrom"
                    type="date"
                    class="form-control"
                    autocomplete
                    value="<%= filter.from %>"
                />
            </div>

            <label for="dateTo">Dan Plačila - do:</label>
            <div class="input-group mb-3">
                <input
                    id="dateTo"
                    name="dateTo"
                    type="date"
                    class="form-control"
                    autocomplete
                    value="<%= filter.to %>"
                />
            </div>

            <div class="d-grid col-12 mx-auto">
                <button class="btn btn-secondary">Filtriraj</button>
            </div>
        </form>
    </div>

    <div class="col-md-3 mb-4">
        <div class="card">
            <div class="card-body">
                <p class="display-6">Obračun</p>
                <% for (user of comparison.usersObject) { %>
                <div>
                    <h5 class="lead">
                        <b><%= user.name %></b>: <%= user.payments%> €
                    </h5>
                </div>
                <% } %>
                <h4>Skupaj: <%= sum %> €</h4>
                <h3 class="lead text-success"><%= comparison.textOutput%></h3>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card">
            <div class="card-body">
                <canvas id="myChartCategories"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-3 mb-4">
        <div class="card">
            <div class="card-body">
                <canvas id="myChartUsers"></canvas>
            </div>
        </div>
    </div>
    <% for (parentCategory of comparison.parentCategoriesObject) { %>
    <div class="col-md-3 table-responsive">
        <table class="table table-hover">
            <thead class="table-light">
                <tr>
                    <th scope="col" scope="col">Datum</th>
                    <th scope="col"><%= parentCategory.name %></th>
                    <th scope="col">Strošek</th>
                    <th class="col" scope="col">Plačnik</th>
                </tr>
            </thead>
            <tbody>
                <% for (expense of expenses) { %> <%
                if(expense.category.parentCategory.name === parentCategory.name)
                { %>
                <tr>
                    <td>
                        <a href="/expenses/<%= expense.id %>">
                            <%=expense.payDate.toLocaleDateString('locales')
                            %></a
                        >
                    </td>
                    <td><%=expense.category.name %></td>
                    <td><%=expense.cost %> €</td>
                    <td class="col"><%=expense.payer.username %></td>
                </tr>
                <% } %> <% } %>
            </tbody>
        </table>
    </div>
    <% } %>
</div>
<script>
    const expenses = <%- JSON.stringify(expenses) %>
    const parentCategoriesObject = <%- JSON.stringify(comparison.parentCategoriesObject) %>
    const usersObject = <%- JSON.stringify(comparison.usersObject) %>
    const usersColor = <%- JSON.stringify(comparison.usersColor) %>
    const categoriesColor = <%- JSON.stringify(comparison.categoriesColor) %>
</script>
<script src="/javascripts/chart.js"></script>
